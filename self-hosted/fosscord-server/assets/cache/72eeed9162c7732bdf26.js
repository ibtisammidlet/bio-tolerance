"use strict";(this.webpackChunkdiscord_app=this.webpackChunkdiscord_app||[]).push([[10170],{511004:(e,t,n)=>{n.r(t);n.d(t,{default:()=>r,wasmCropGIF:()=>a});function r(){return n.e(5522).then(n.bind(n,305522))}async function a(e,t,n,a,i){return(await r()).crop_gif(e,t,n,a,i)}},810170:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default=void 0;var r,a=N(n(667294)),i=n(496486),o=b(n(954140)),u=b(n(37039)),l=b(n(552173)),c=b(n(421338)),s=N(n(956117)),d=b(n(118777)),f=n(354479),p=n(688388),h=b(n(602358)),A=n(3400),v=b(n(308920)),y=n(674645),_=b(n(511004)),g=n(173708),E=n(770348),m=n(280696),w=b(n(247001)),R=b(n(766649));function b(e){return e&&e.__esModule?e:{default:e}}function M(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(M=function(e){return e?n:t})(e)}function N(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=M(t);if(n&&n.has(e))return n.get(e)
;var r={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var o=a?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(r,i,o):r[i]=e[i]}r.default=e;n&&n.set(e,r);return r}function S(){S=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};return S.apply(this,arguments)}function I(e,t,n,a){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=a;else if(o>1){for(var u=new Array(o),l=0;l<o;l++)u[l]=arguments[l+3];t.children=u}if(t&&i)for(var c in i)void 0===t[c]&&(t[c]=i[c]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function T(e,t,n,r,a,i,o){try{var u=e[i](o),l=u.value}catch(e){n(e);return}
u.done?t(l):Promise.resolve(l).then(r,a)}function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,i=[],o=!0,u=!1;try{for(n=n.call(e);!(o=(r=n.next()).done);o=!0){i.push(r.value);if(t&&i.length===t)break}}catch(e){u=!0;a=e}finally{try{o||null==n.return||n.return()}finally{if(u)throw a}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return L(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return L(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){(null==t||t>e.length)&&(t=e.length)
;for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var D=function(e){var t=e.file,n=e.imgURI,r=e.transitionState,b=e.allowSkip,M=void 0!==b&&b,N=e.onCrop,L=e.onClose,D=e.uploadType,O=void 0===D?g.UploadTypes.AVATAR:D,P=e.showUpsellHeader,U=void 0!==P&&P,k=e.analyticsPage,x=C(a.useState({width:0,height:0}),2),B=x[0],V=x[1],G=C(a.useState({top:0,bottom:0,left:0,right:0}),2),H=G[0],j=G[1],F=C(a.useState(!1),2),X=F[0],z=F[1],W=C(a.useState(1),2),Y=W[0],K=W[1],Z=C(a.useState({x:0,y:0}),2),$=Z[0],q=Z[1],J=C(a.useState(null),2),Q=J[0],ee=J[1],te=C(a.useState(!1),2),ne=te[0],re=te[1],ae=(0,u.default)(o.default.IMAGE_CROPPING_MODAL).AnalyticsLocationProvider,ie=c.default.useExperiment({}).showProfileSkins,oe=a.useRef({x:0,y:0}),ue=a.useRef(null),le=a.useRef(null),ce=(0,f.useUID)(),se="image/gif"===t.type;a.useEffect((function(){(0,_.default)()}),[]);a.useEffect((function(){se&&U&&v.default.track(E.AnalyticEvents.OPEN_MODAL,{type:E.AnalyticsSections.CROP_GIF_MODAL,location:{page:k}})
}),[U,k,se]);var de=function(){switch(O){case g.UploadTypes.BANNER:return{height:g.USER_BANNER_MAX_HEIGHT,width:g.USER_BANNER_MAX_WIDTH};case g.UploadTypes.BANNER_V2:return{height:g.USER_BANNER_V2_MAX_HEIGHT,width:g.USER_BANNER_V2_MAX_WIDTH};case g.UploadTypes.VIDEO_BACKGROUND:return m.BACKGROUND_REPLACEMENT_SIZE;case g.UploadTypes.AVATAR:return{height:E.AVATAR_MAX_SIZE,width:E.AVATAR_MAX_SIZE};case g.UploadTypes.GUILD_BANNER:return{height:g.GUILD_BANNER_MAX_HEIGHT,width:g.GUILD_BANNER_MAX_WIDTH};case g.UploadTypes.SCHEDULED_EVENT_IMAGE:return{height:g.SCHEDULED_EVENT_IMAGE_MAX_HEIGHT,width:g.SCHEDULED_EVENT_IMAGE_MAX_WIDTH}}},fe=a.useCallback((function(e,t,n){oe.current=(0,y.getBoundedCoordinates)(e,t,n);null!=ue.current&&(ue.current.style.transform="translate3d("+oe.current.x+"px, "+oe.current.y+"px, 0)")}),[ue]),pe=a.useCallback((function(){if(!(null==ue.current||Y>1)){var e=ue.current.getBoundingClientRect(),t=e.width,n=e.height,r=(0,
y.adjustImageDimensionsForAspectRatio)(O,t,n),a=r.width,i=r.height,o=(0,y.calculateOverlaySize)(O,a,i,n);ee({width:a,height:i});V(o);j((0,y.calculateDragBoundaries)(a,i,o))}}),[O,Y]),he=a.useCallback((function(e){var t=oe.current,n=t.x,r=t.y;if(X&&(e.clientX!==n||e.clientY!==r)){var a=e.clientX-$.x,i=e.clientY-$.y;fe(a,i,H)}}),[H,X,$,fe]),Ae=function(){z(!1)},ve=function(){var e,n=(e=regeneratorRuntime.mark((function e(){var n,r,a,i,o,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=ue.current){e.next=2;break}return e.abrupt("return");case 2:re(!0);n=ue.current;r=de();if(!se){e.next=26;break}e.prev=6;e.next=9;return(0,y.cropGIF)(t,n,B,oe.current,r);case 9:i=e.sent;o=i.result;u=i.cancelFn;le.current=u;e.next=15;return o;case 15:a=e.sent;le.current=null;e.next=24;break;case 19:e.prev=19;e.t0=e.catch(6);null===(l=le.current)||void 0===l||l.call(le);le.current=null;throw Error("Error cropping GIF");case 24:e.next=27;break;case 26:a=(0,
y.cropStaticImage)(n,B,oe.current,r);case 27:e.next=29;return N(a,t);case 29:re(!1);L();case 31:case"end":return e.stop()}}),e,null,[[6,19]])})),function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){T(i,r,a,o,u,"next",e)}function u(e){T(i,r,a,o,u,"throw",e)}o(void 0)}))});return function(){return n.apply(this,arguments)}}();a.useEffect((function(){window.addEventListener("mouseup",Ae);window.addEventListener("resize",pe);return function(){window.removeEventListener("mouseup",Ae);window.removeEventListener("resize",pe)}}),[pe]);a.useEffect((function(){return function(){null!=le.current&&le.current()}}),[]);a.useEffect((function(){if(X){window.addEventListener("mousemove",he);return function(){return window.removeEventListener("mousemove",he)}}}),[he,X]);return I(ae,{},void 0,I(A.ModalRoot,{onAnimationEnd:pe,transitionState:r,size:A.ModalSize.MEDIUM,"aria-labelledby":ce},void 0,U&&I(l.default,{type:O,analyticsPage:k,
analyticsSection:E.AnalyticsSections.CROP_GIF_MODAL,isGIF:se,banner:n}),I(A.ModalHeader,{separator:!1,id:ce},void 0,I(p.FormTitle,{className:R.default.titleCase,tag:p.FormTitleTags.H1},void 0,w.default.Messages.AVATAR_UPLOAD_EDIT_MEDIA)),I(A.ModalContent,{className:R.default.modalContent},void 0,I("div",{className:R.default.editingContainer},void 0,a.createElement("img",{style:S({opacity:null==Q?0:1,transform:"translate3d("+oe.current.x+"px, "+oe.current.y+"px, 0px)"},function(){if(null==Q)return{};var e,t=ie?g.BANNER_V2_ASPECT_RATIO:g.BANNER_ASPECT_RATIO,n=Q.width/Q.height,r=(e=de()).width!==e.height&&n>t?B.height/Q.height:1;return{width:Q.width*Y*r,minWidth:Q.width*Y*r,height:Q.height*Y*r}}()),className:ne?R.default.imageDisabled:R.default.imageEnabled,src:n,alt:"avatar",ref:ue,onMouseDown:function(e){var t=e.clientX-oe.current.x,n=e.clientY-oe.current.y;q({x:t,y:n});z(!0)},draggable:!1}),I("div",{className:O===g.UploadTypes.AVATAR?R.default.overlayAvatar:R.default.overlayBanner,
style:{opacity:null==Q?0:1,width:B.width,height:B.height}})),I("div",{className:R.default.sliderContainer},void 0,I(h.default,{className:R.default.icon,width:24,height:24}),I(d.default,{initialValue:1,minValue:1,maxValue:2,keyboardStep:.025,asValueChanges:function(e){if(null!=Q){var t=Q.width,n=Q.height,r=(0,y.calculateDragBoundaries)(t*e,n*e,B),a=oe.current,o=a.x,u=a.y;(0,i.inRange)(o,r.right,r.left)&&(0,i.inRange)(u,r.top,r.bottom)||fe(o,u,r);K(e);j(r)}},disabled:ne,equidistant:!0,hideBubble:!0,"aria-label":w.default.Messages.FORM_LABEL_AVATAR_SIZE}),I(h.default,{className:R.default.icon,width:48,height:48}))),I(A.ModalFooter,{className:R.default.modalFooter},void 0,M?I(s.default,{className:R.default.cancelButton,look:s.default.Looks.LINK,color:s.default.Colors.PRIMARY,size:s.ButtonSizes.SMALL,onClick:function(){if(M){N(n,t);L()}}},void 0,w.default.Messages.AVATAR_UPLOAD_SKIP):null,I("div",{className:R.default.buttonsRight},void 0,I(s.default,{className:R.default.cancelButton,
look:s.default.Looks.LINK,color:s.default.Colors.PRIMARY,size:s.ButtonSizes.SMALL,onClick:function(){if(null==le.current)L();else{le.current();le.current=null;re(!1)}}},void 0,w.default.Messages.AVATAR_UPLOAD_CANCEL),I(s.default,{submitting:ne,size:s.ButtonSizes.SMALL,onClick:ve},void 0,w.default.Messages.AVATAR_UPLOAD_APPLY)))))};D.displayName="ImageCroppingModal";var O=D;t.default=O}}]);
//# sourceMappingURL=72eeed9162c7732bdf26.js.map